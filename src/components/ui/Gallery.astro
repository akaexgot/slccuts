---
import { Image } from "astro:assets";
import { supabase } from "../../lib/supabase";

// Fetch images from Supabase
const { data: images } = await supabase
    .from("gallery_images")
    .select("*")
    .eq("active", true)
    .order("created_at", { ascending: false });

const cleanUrl = (url: string) => {
    if (url && url.includes("?")) {
        return url.split("?")[0];
    }
    return url;
};

// If no images are active, we don't display anything or we pass an empty array
const displayImages =
    images?.map((img: any) => ({
        ...img,
        image_url: cleanUrl(img.image_url),
    })) || [];
---

{
    displayImages.length > 0 && (
        <div class="w-full relative group">
            <!-- Scroll Container -->
            <div
                class="flex overflow-x-auto snap-x snap-mandatory scrollbar-hide gap-4 pb-4 px-4 md:px-0"
                style="-ms-overflow-style: none; scrollbar-width: none;"
            >
                {
                    displayImages.map((img: any, index: number) => (
                        <div class="snap-center shrink-0 w-[80vw] md:w-[400px] h-[300px] md:h-[400px] relative overflow-hidden rounded-lg shadow-md aspect-square filter grayscale hover:grayscale-0 transition-all duration-500 cursor-pointer group">
                    <Image
                        src={img.image_url}
                        alt={img.alt_text || "GalerÃ­a SLC CUTS"}
                        title={img.description || ""}
                        width={600}
                        height={600}
                        class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-700"
                        loading="lazy"
                    />
                    {img.description && (
                        <div class="absolute bottom-0 left-0 right-0 bg-black/60 p-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                            <p class="text-white text-sm font-medium truncate">
                                {img.description}
                            </p>
                        </div>
                    )}
                </div>
            ))
        }
    </div>

    <!-- Gradient Fade for scroll indication (optional aesthetic) -->
    <div
        class="absolute top-0 right-0 h-full w-20 bg-gradient-to-l from-white to-transparent pointer-events-none md:hidden"
    >
    </div>
    </div>
    )
}
</div>

<style>
    /* Hide scrollbar for Chrome, Safari and Opera */
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }
</style>
