---
export const prerender = false;
import Layout from "../layouts/Layout.astro";
import Gallery from "../components/ui/Gallery.astro";
import Marquee from "../components/ui/Marquee.astro";
import { supabase } from "../lib/supabase";
import ProductCard from "../components/ui/ProductCard.astro";
import MosaicBackground from "../components/ui/MosaicBackground.astro";
import { Image } from "astro:assets";

const cleanUrl = (url: string) => {
	if (url && url.includes("?")) {
		return url.split("?")[0];
	}
	return url;
};

const { data: rawFeaturedProducts } = await supabase
	.from("products")
	.select(
		"*, product_images(image_url), stock(quantity), category:categories(name, slug)",
	)
	.eq("active", true)
	.eq("is_featured", true)
	.limit(5);

const featuredProducts = (rawFeaturedProducts || []).map((product: any) => ({
	...product,
	image_url: cleanUrl(product.product_images?.[0]?.image_url),
}));

const { data: rawCategories } = await supabase
	.from("categories")
	.select("*")
	.limit(6);

const categories = (rawCategories || []).map((cat: any) => ({
	...cat,
	image_url: cleanUrl(cat.image_url),
}));

const { data: latestNews } = await supabase
	.from("news")
	.select("*")
	.eq("is_published", true)
	.order("created_at", { ascending: false })
	.limit(1);
---

<Layout title="SLC CUTS | Barbería & Productos">
	<main class="flex-1">
		<!-- Marquee Section (Below Menu) -->
		<Marquee
			phrases={[
				"SLC CUTS",
				"ESTILO CLÁSICO",
				"BARBERÍA MODERNA",
				"PRODUCTOS PREMIUM",
			]}
		/>

		<!-- Hero Section -->
		<div
			class="relative min-h-screen flex items-center justify-center overflow-hidden bg-black animate-on-scroll"
		>
			<!-- Background Image with Overlay -->
			<div class="absolute inset-0 z-0">
				<Image
					src={cleanUrl(
						"https://images.unsplash.com/photo-1585747860715-2ba37e788b70",
					)}
					alt="Barbershop Interior"
					width={1920}
					height={1080}
					format="webp"
					class="w-full h-full object-cover scale-110 motion-safe:animate-[slowZoom_20s_infinite_alternate]"
					loading="eager"
					fetchpriority="high"
				/>
				<div
					class="absolute inset-0 bg-gradient-to-b from-black/80 via-black/40 to-[#050505]"
				>
				</div>
			</div>

			<!-- Hero Content -->
			<div class="relative z-10 text-center text-white px-4 max-w-6xl">
				<div class="animate-on-scroll mb-12">
					<Image
						src="/logoblancotransparente.png"
						alt="SLC CUTS"
						width={300}
						height={300}
						format="webp"
						class="h-56 w-auto mx-auto mix-blend-screen logo-diamond drop-shadow-[0_0_30px_rgba(255,255,255,0.2)]"
						loading="eager"
					/>
				</div>

				<h1
					class="text-7xl md:text-[12rem] mb-6 font-bebas tracking-[-0.02em] leading-[0.85] uppercase animate-on-scroll drop-shadow-2xl"
				>
					Maestría &<br /><span class="text-white/40">Vanguardia</span
					>
				</h1>
				<p
					class="text-sm md:text-lg text-gray-400 mb-16 font-outfit tracking-[0.6em] font-black uppercase animate-on-scroll"
				>
					Barbería de Autor • Cuidado Premium • Estética sin Límites
				</p>
				<div
					class="flex flex-col md:flex-row gap-6 justify-center animate-on-scroll"
				>
					<a
						href="/services"
						class="group relative overflow-hidden bg-white text-black px-16 py-5 rounded-full font-black tracking-[0.2em] transition-all hover:scale-105 active:scale-95 shadow-2xl shadow-white/20"
					>
						<span class="relative z-10">RESERVAR</span>
						<div
							class="absolute inset-0 bg-gray-200 translate-y-full group-hover:translate-y-0 transition-transform duration-300"
						>
						</div>
					</a>
					<a
						href="/shop/new"
						class="border border-white/20 backdrop-blur-md text-white px-12 py-5 rounded-full font-black tracking-[0.2em] hover:bg-white hover:text-black transition-all hover:scale-105 active:scale-95"
					>
						Tienda Online
					</a>
				</div>
			</div>
		</div>

		<!-- About Section -->
		<section
			id="about"
			class="py-32 bg-[#050505] animate-on-scroll relative overflow-hidden"
		>
			<!-- Mosaic Background -->
			<MosaicBackground mode="dark" opacity="opacity-[0.03]" />

			<div class="container mx-auto px-4 relative z-10">
				<div class="flex flex-col md:flex-row items-center gap-20">
					<div class="flex-1 space-y-12">
						<div class="space-y-4">
							<h2
								class="text-xs font-black uppercase tracking-[0.5em] text-white/40 font-outfit animate-on-scroll"
							>
								Legado & Estilo
							</h2>
							<h3
								class="text-5xl md:text-7xl font-bebas tracking-tight uppercase animate-on-scroll"
							>
								La Esencia <span class="text-white/60">SLC</span
								>
							</h3>
						</div>

						<div
							class="space-y-8 text-gray-400 text-xl leading-relaxed italic font-medium"
						>
							<p class="animate-on-scroll">
								En SLC CUTS fusionamos la barbería tradicional
								con las tendencias urbanas más actuales. Nuestro
								equipo de expertos no solo corta cabello, diseña
								tu mejor versión.
							</p>
							<p class="animate-on-scroll">
								Utilizamos y vendemos solo productos de alta
								calidad que garantizan el mejor cuidado para tu
								cabello y barba.
							</p>
						</div>

						<div class="pt-8 animate-on-scroll">
							<a
								href="/gallery"
								class="inline-flex items-center gap-4 text-xs font-black uppercase tracking-widest text-white border-b-2 border-white/10 hover:border-white transition-all pb-2"
							>
								Descubre el estudio <span class="text-xl"
									>→</span
								>
							</a>
						</div>
					</div>

					<!-- Gallery Section (Right side) -->
					<div class="flex-1 w-full scale-105 animate-on-scroll">
						<Gallery />
					</div>
				</div>
			</div>
		</section>

		<!-- Featured Categories -->
		<section
			class="py-32 bg-black text-white animate-on-scroll relative overflow-hidden"
		>
			<MosaicBackground mode="dark" opacity="opacity-5" />

			<div class="container mx-auto px-4 relative z-10">
				<div class="text-center max-w-4xl mx-auto mb-24">
					<h2
						class="text-[10px] font-black uppercase tracking-[0.5em] text-white/30 mb-6 font-outfit animate-on-scroll"
					>
						Premium Collections
					</h2>
					<h3
						class="text-6xl md:text-[10rem] font-bebas uppercase tracking-tighter leading-[0.9] animate-on-scroll"
					>
						Explora <span class="text-white/20 italic"
							>el Arsenal</span
						>
					</h3>
				</div>

				<div class="flex flex-wrap justify-center gap-12">
					{
						categories?.map((cat: any) => {
							let img =
								cat.image_url ||
								"https://images.unsplash.com/photo-1621605815971-fbc98d665033?q=75&w=800&auto=format&fit=crop";

							return (
								<a
									href={`/shop/${cat.slug}`}
									class="group relative h-[600px] w-full md:w-[calc(50%-3rem)] lg:w-[calc(33.333%-3rem)] overflow-hidden rounded-[3rem] block animate-on-scroll border border-white/5 hover:border-white/20 transition-all duration-1000"
								>
									<div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent opacity-80 group-hover:opacity-40 transition-opacity z-10" />
									<Image
										src={img}
										alt={cat.name}
										width={800}
										height={1200}
										format="webp"
										class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-1000 grayscale group-hover:grayscale-0"
									/>
									<div class="absolute inset-x-0 bottom-12 flex flex-col items-center justify-center z-20 text-center">
										<h4 class="text-4xl font-bebas uppercase tracking-widest mb-4 transform group-hover:translate-y-[-10px] transition-transform duration-700">
											{cat.name}
										</h4>
										<div class="w-16 h-[2px] bg-white scale-x-0 group-hover:scale-x-100 transition-transform duration-700 origin-center" />
									</div>
								</a>
							);
						})
					}
				</div>
			</div>
		</section>

		<section
			class="py-32 bg-[#0a0a0a] animate-on-scroll relative overflow-hidden"
		>
			<MosaicBackground mode="dark" opacity="opacity-[0.02]" />

			<div class="container mx-auto px-4 text-center relative z-10">
				<div class="mb-20">
					<h2
						class="text-[10px] font-black uppercase tracking-[0.5em] text-white/30 mb-6 font-outfit"
					>
						Essential Equipment
					</h2>
					<h3
						class="text-5xl md:text-8xl font-bebas tracking-tight uppercase"
					>
						Productos <span class="text-white/40 italic"
							>Destacados</span
						>
					</h3>
				</div>

				<div
					class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-8"
				>
					{
						(featuredProducts || []).map(
							(product: any, index: number) => (
								<ProductCard
									product={{
										...product,
										image_url:
											product.product_images?.[0]
												?.image_url,
									}}
									loading="lazy"
								/>
							),
						)
					}
				</div>

				<div class="mt-20">
					<a
						href="/shop/new"
						class="inline-flex items-center gap-6 text-[10px] font-black uppercase tracking-[0.4em] text-white/60 hover:text-white transition-all group"
					>
						EXPLORAR TODO EL CATÁLOGO
						<span
							class="text-xl transform group-hover:translate-x-2 transition-transform"
							>→</span
						>
					</a>
				</div>
			</div>
		</section>

		<!-- News/Section -->
		{
			latestNews && latestNews.length > 0 && (
				<section class="py-32 bg-[#050505] animate-on-scroll relative overflow-hidden border-t border-white/5">
					<div class="container mx-auto px-4 relative z-10">
						<div class="flex flex-col md:flex-row items-end justify-between mb-24 gap-8">
							<div class="max-w-xl">
								<h2 class="text-[10px] font-black uppercase tracking-[0.5em] text-white/30 mb-6 font-outfit">
									Actualidad SLC
								</h2>
								<h3 class="text-6xl md:text-9xl font-bebas uppercase tracking-tighter leading-[0.85] text-white">
									Noticias
									<>
										<br />
										<span class="text-white/20 italic">
											Recientes
										</span>
									</>
								</h3>
							</div>
							<a
								href="/news"
								class="text-xs font-black uppercase tracking-widest text-white/40 hover:text-white border-b border-white/10 hover:border-white transition-all pb-2"
							>
								Ver todo el blog
							</a>
						</div>

						<div class="grid grid-cols-1 gap-20">
							{latestNews.map((news: any) => (
								<article class="flex flex-col lg:flex-row gap-12 lg:gap-24 items-center group animate-on-scroll">
									<a
										href={`/news/${news.slug}`}
										class="w-full lg:w-3/5 aspect-[16/8] rounded-[3rem] overflow-hidden bg-white/5 block border border-white/5 relative group"
									>
										{news.image_url ? (
											<Image
												src={news.image_url}
												alt={news.title}
												width={1200}
												height={675}
												class="w-full h-full object-cover transform scale-105 group-hover:scale-100 grayscale hover:grayscale-0 transition-all duration-1000 opacity-60 group-hover:opacity-100"
											/>
										) : (
											<div class="w-full h-full flex items-center justify-center text-white/5 text-9xl italic font-black uppercase">
												SLC
											</div>
										)}
										<div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent" />
									</a>

									<div class="w-full lg:w-2/5 space-y-8">
										<div class="flex items-center gap-6">
											<span class="w-16 h-[1px] bg-white/20" />
											<span class="text-[10px] font-black uppercase tracking-[0.5em] text-white/40">
												{new Date(
													news.created_at,
												).toLocaleDateString("es-ES", {
													day: "2-digit",
													month: "long",
													year: "numeric",
												})}
											</span>
										</div>
										<h4 class="text-5xl md:text-6xl font-bebas uppercase tracking-tight leading-tight group-hover:text-white transition-colors">
											<a href={`/news/${news.slug}`}>
												{news.title}
											</a>
										</h4>
										<p class="text-gray-500 text-xl leading-relaxed line-clamp-3 italic font-medium">
											{news.content}
										</p>
										<div class="pt-6">
											<a
												href={`/news/${news.slug}`}
												class="inline-flex items-center gap-6 text-[10px] font-black uppercase tracking-[0.4em] text-white group-hover:gap-10 transition-all"
											>
												LEER ARTÍCULO{" "}
												<span class="text-2xl">→</span>
											</a>
										</div>
									</div>
								</article>
							))}
						</div>
					</div>
				</section>
			)
		}
	</main>
	<style>
		.logo-diamond {
			transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
			cursor: pointer;
		}
		.logo-diamond:hover {
			transform: perspective(1000px) rotate3d(0, 1, 0, 360deg);
		}

		@keyframes slowZoom {
			from {
				transform: scale(1.05);
			}
			to {
				transform: scale(1.15);
			}
		}
	</style>
</Layout>
